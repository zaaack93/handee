import{r as e,t}from"./shared-import-theme-a11y.bundle.min.js";window.ThemeComponent_PredictiveSearch=s=>({cachedResults:{},loading:!1,isOpen:!1,rawQuery:"",results:!1,resultsMarkup:null,resources:s,get trimmedQuery(){return this.rawQuery.trim()},mounted(){this.cachedResults={};document.querySelectorAll("[data-open-search]").forEach((e=>{e.setAttribute("role","button")})),document.addEventListener("keyup",(e=>{"Escape"===e.key&&(this.close(!1,!0),setTimeout((()=>this.$refs.input.focus()),100))}))},close(t=!1,s=!1){this.isOpen=!1,t&&(this.rawQuery="");const r=this.$el.querySelector('[aria-selected="true"]');r&&r.setAttribute("aria-selected",!1),this.$refs.input.setAttribute("aria-activedescendant",""),this.$refs.input.setAttribute("aria-expanded",!1),e(),document.documentElement.style.overflowY="auto",s&&document.body.dispatchEvent(new CustomEvent("label:search:closebutton"));const i=document.querySelector("[data-open-search]");i&&setTimeout((()=>i.focus()),100)},getSearchResults(){this.loading=!0;const e=this.trimmedQuery.replace(" ","-").toLowerCase();liveRegion(window.theme.strings.loading),fetch(`${window.theme.routes.predictive_search_url}?q=${encodeURIComponent(this.trimmedQuery)}&${encodeURIComponent("resources[type]")}=${this.resources}&${encodeURIComponent("resources[limit]")}=10&section_id=predictive-search`).then((e=>{if(this.loading=!1,!e.ok){var t=new Error(e.status);throw this.close(),t}return e.text()})).then((t=>{this.results=!0;const s=(new DOMParser).parseFromString(t,"text/html").querySelector("#shopify-section-predictive-search").innerHTML,r=(new DOMParser).parseFromString(t,"text/html").querySelector("#predictive-search-count").textContent;this.cachedResults[e]=s,this.renderSearchResults(s),liveRegion(r)})).catch((e=>{throw this.close(),e}))},onChange(){this.trimmedQuery.length?(this.open(),this.getSearchResults()):this.close(!0)},onFocus(){this.trimmedQuery.length&&(!0===this.results?this.open():this.getSearchResults())},onFocusOut(){setTimeout((()=>{this.$el.contains(document.activeElement)||this.close()}))},onFormSubmit(e){this.trimmedQuery.length&&!this.$el.querySelector('[aria-selected="true"] a')||e.preventDefault()},onKeyup(e){switch(e.preventDefault(),e.code){case"ArrowUp":this.switchOption("up");break;case"ArrowDown":this.switchOption("down");break;case"Enter":this.selectOption()}},onKeydown(e){"ArrowUp"!==e.code&&"ArrowDown"!==e.code||e.preventDefault()},open(){this.isOpen=!0,this.$refs.input.setAttribute("aria-expanded",!0),document.documentElement.style.overflowY="hidden"},renderSearchResults(e){this.$refs.results.innerHTML=e,this.results=!0,this.open(),setTimeout((()=>{t(this.$el),this.$refs.input.focus()}),300)},selectOption(){const e=this.$el.querySelector('[aria-selected="true"] a, [aria-selected="true"] button');e&&e.click()},switchOption(e){if(!this.isOpen)return;const t="up"===e,s=this.$el.querySelector('[aria-selected="true"]'),r=this.$el.querySelectorAll("li");let i=this.$el.querySelector("li");t&&!s||(!t&&s?i=s.nextElementSibling||r[0]:t&&(i=s.previousElementSibling||r[r.length-1]),i!==s&&(i.setAttribute("aria-selected",!0),s&&s.setAttribute("aria-selected",!1),this.$refs.input.setAttribute("aria-activedescendant",i.id)))}});
